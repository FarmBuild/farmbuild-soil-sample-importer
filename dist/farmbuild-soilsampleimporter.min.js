"use strict";angular.module("farmbuild.soilSampleImporter",["farmbuild.core","farmbuild.farmdata"]).factory("soilSampleImporter",function(soilSampleImporterSession,soilSampleConverter,importField,soilSampleValidator,soilClassification,paddockSoilSampleRetriever,paddockGroups,importFieldSelector,farmdata,validations,googleAnalyticsSoilSampleImporter,$log){var soilSampleImporter={farmdata:farmdata},_isDefined=(validations.isPositiveNumber,validations.isDefined);return soilSampleImporter.version="0.1.0",soilSampleImporter.ga=googleAnalyticsSoilSampleImporter,soilSampleImporter.session=soilSampleImporterSession,$log.info("Welcome to Soil Sample Importer... this should only be initialised once! why we see twice in the example?"),soilSampleImporter.find=function(){return soilSampleImporterSession.find()},soilSampleImporter.load=function(inputFarmData){var loaded=farmdata.load(inputFarmData);return $log.info("loaded "+JSON.stringify(loaded,null,"  ")),_isDefined(loaded)?(loaded.hasOwnProperty("soils")||(loaded.soils={}),loaded.soils.hasOwnProperty("sampleResults")||(loaded.soils.sampleResults=soilSampleImporter.soilSampleConverter.createDefault(),loaded=farmdata.update(loaded)),loaded):void 0},soilSampleImporter["export"]=soilSampleImporterSession["export"],soilSampleImporter.soilSampleConverter=soilSampleConverter,soilSampleImporter.soilSampleValidator=soilSampleValidator,soilSampleImporter.soilClassification=soilClassification,soilSampleImporter.importField=importField,soilSampleImporter.importFieldSelector=importFieldSelector,soilSampleImporter.paddockSoilSampleRetriever=paddockSoilSampleRetriever,soilSampleImporter.paddockGroups=paddockGroups,"undefined"==typeof window.farmbuild?window.farmbuild={soilSampleImporter:soilSampleImporter}:window.farmbuild.soilSampleImporter=soilSampleImporter,soilSampleImporter}),angular.module("farmbuild.soilSampleImporter").factory("soilSampleConverter",function($log,farmdata,validations,soilSampleValidator,soilSampleImporterSession,importField){function createDefault(){return{dateLastUpdated:new Date,results:{columnHeaders:[],rows:[]},importFieldDictionary:{},paddockRowDictionary:{},paddockNameColumn:void 0}}function toFarmData(farmData,newSampleResults){if(!_isDefined(farmData))return void $log.error("Invalid farmdata for soilSamplConverter.toFarmData");if(!_isDefined(newSampleResults))return void $log.error("Invalid newSampleResults for soilSamplConverter.toFarmData");if(!soilSampleValidator.isValidSoilSampleResult(newSampleResults))return void $log.error("Invalid newSampleResults for soilSamplConverter.toFarmData");var currentSoils={};_isDefined(farmData.soils)&&(currentSoils=farmData.soils);var currentPaddocks=farmData.paddocks;if(!_isDefined(currentPaddocks))return void $log.error("Invalid FarmData for soilSamplConverter.toFarmData");var farmDataSampleResults={},newResults=newSampleResults.results,newImportFieldDictionary=newSampleResults.importFieldDictionary,importFieldNames=[];importFieldNames=Object.keys(newImportFieldDictionary),farmDataSampleResults.dateLastUpdated=newSampleResults.dateLastUpdated,farmDataSampleResults.importFieldNames=importFieldNames,currentSoils.sampleResults=farmDataSampleResults;for(var rows=newResults.rows,paddockRowDictionary=newSampleResults.paddockRowDictionary,i=0;i<currentPaddocks.length;i++){var singlePaddock=currentPaddocks[i],paddockRows=paddockRowDictionary[singlePaddock.name];if(_isDefined(paddockRows)&&0!=paddockRows.length){for(var singlePaddockSoils=[],k=0;k<paddockRows.length;k++){for(var rowValues=rows[paddockRows[k]],sampleValue={},j=0;j<importFieldNames.length;j++){var indexOfValue=newImportFieldDictionary[importFieldNames[j]],rowFieldValue=rowValues[indexOfValue];importField.hasAverage(importFieldNames[j])&&(_isEmpty(rowFieldValue)&&isNaN(rowFieldValue)&&null==rowFieldValue||(rowFieldValue=parseFloat(rowFieldValue))),sampleValue[importFieldNames[j]]=rowFieldValue}singlePaddockSoils.push(sampleValue)}singlePaddock.soils=setSoilSamplResult(singlePaddock.soils,singlePaddockSoils),currentPaddocks[i]=singlePaddock}else singlePaddock.soils=setSoilSamplResult(singlePaddock.soils,void 0),currentPaddocks[i]=singlePaddock}return farmData.dateLastUpdated=newSampleResults.dateLastUpdated,farmData.soils=currentSoils,farmData.paddocks=currentPaddocks,farmData}var _isDefined=validations.isDefined,_isEmpty=(validations.isArray,validations.isEmpty),soilSampleConverter={};soilSampleConverter.createDefault=createDefault,soilSampleConverter.toFarmData=toFarmData;var setSoilSamplResult=function(currentPaddockSoil,singlePaddockSoilValue){var paddockSoil={};return _isDefined(currentPaddockSoil)&&(paddockSoil=currentPaddockSoil),paddockSoil.sampleResults=singlePaddockSoilValue,paddockSoil};return soilSampleConverter}),angular.module("farmbuild.soilSampleImporter").factory("soilSampleValidator",function($log,farmdata,validations){{var soilSampleValidator={},_isDefined=validations.isDefined;validations.isArray}return soilSampleValidator.isValidFarmDataWithSoilSample=function(farmData){var soils=farmData.soils;if(!_isDefined(soils))return!1;var soilSampleResults=soils.sampleResults;if(!_isDefined(soilSampleResults))return!1;var dateLastUpdated=soilSampleResults.dateLastUpdated;if(!_isDefined(dateLastUpdated))return!1;var importFieldNames=soilSampleResults.importFieldNames;if(!_isDefined(importFieldNames))return!1;if(!_isDefined(farmData.paddocks))return!1;var paddocks=farmData.paddocks[0];return _isDefined(paddocks.soils)?!0:!1},soilSampleValidator.isValidSoilSampleResult=function(soilSampleResult){var results=soilSampleResult.results;if(!_isDefined(results))return!1;var columnHeaders=results.columnHeaders;if(!_isDefined(columnHeaders))return!1;var rowsData=results.rows;if(!_isDefined(rowsData))return!1;if(!_isDefined(soilSampleResult.importFieldDictionary))return!1;if(!_isDefined(soilSampleResult.paddockRowDictionary))return!1;var numberOfPaddocks=Object.keys(soilSampleResult.paddockRowDictionary).length;if($log.info("numberOfPaddocks "+numberOfPaddocks),!(numberOfPaddocks>0))return!1;var totalCSVColumns=columnHeaders.length;$log.info("Columns in the column headers key "+totalCSVColumns);for(var i=0;i<rowsData.length;i++){var singleRow=rowsData[i];if(singleRow.length!=totalCSVColumns)return $log.error("The "+i+" row with paddick name "+singleRow[0]+" doesn't have required number of columns"),!1}return!0},soilSampleValidator}),angular.module("farmbuild.soilSampleImporter").factory("googleAnalyticsSoilSampleImporter",function($log,validations,googleAnalytics){var googleAnalyticsSoilSampleImporter={},api="farmbuild-soil-sample-importer",_isDefined=validations.isDefined;return googleAnalyticsSoilSampleImporter.trackSoilSampleImporter=function(clientName){return _isDefined(clientName)?($log.info("googleAnalyticsImporter.track clientName: %s",clientName),void googleAnalytics.track(api,clientName)):void $log.error("client name is not specified")},googleAnalyticsSoilSampleImporter}),angular.module("farmbuild.soilSampleImporter").constant("importFieldDefaults",{types:[{name:"Sample Id",soilClassificationName:void 0,hasAverage:!1},{name:"Sample Name",soilClassificationName:void 0,hasAverage:!1},{name:"pH H2O (Water)",soilClassificationName:"pH H2O (Water)",hasAverage:!0},{name:"Olsen Phosphorus (mg/kg)",soilClassificationName:"Olsen Phosphorus (mg/kg)",hasAverage:!0},{name:"PBI",soilClassificationName:"PBI",hasAverage:!0},{name:"KCl 40 Sulphur (mg/kg)",soilClassificationName:"KCl 40 Sulphur (mg/kg)",hasAverage:!0},{name:"Colwell Phosphorus (mg/kg)",soilClassificationName:"Colwell Phosphorus (mg/kg)",hasAverage:!0},{name:"Colwell Potassium (mg/kg)",soilClassificationName:"Colwell Potassium (mg/kg)",hasAverage:!0},{name:"Exch Potassium (meq/100g)",soilClassificationName:"Exch Potassium (meq/100g)",hasAverage:!0}]}),angular.module("farmbuild.soilSampleImporter").factory("importField",function($log,importFieldTypes,validations){$log.info("importField ");var importField={};return importField.hasClassification=function(importFieldName){var fieldType=importFieldTypes.byName(importFieldName);return fieldType&&fieldType.soilClassificationName?!0:!1},importField.hasAverage=function(importFieldName){var fieldType=importFieldTypes.byName(importFieldName);return fieldType&&fieldType.hasAverage?!0:!1},importField.getPaddockGroupFields=function(){for(var result=[],allImportFields=importFieldTypes.toArray(),i=0;i<allImportFields.length;i++)allImportFields[i].hasAverage&&result.push(allImportFields[i]);return result},importField}),angular.module("farmbuild.soilSampleImporter").factory("importFieldTypes",function(collections,validations,importFieldDefaults,$log){function _create(name){var type={name:name};return type}function _validate(type){$log.info("validating type  ...",type);var valid=!_isEmpty(type)&&!_isEmpty(type.name);return valid||$log.error("invalid type: %j",type),valid}function _add(types,name){var type=_create(name);return $log.info("adding a type ...",type),_validate(type)?collections.add(types,type):void 0}var importFieldTypes,_isEmpty=(validations.isPositiveNumber,validations.isPositiveNumberOrZero,validations.isEmpty),_types=(validations.isDefined,angular.copy(importFieldDefaults.types));return importFieldTypes={add:_add,at:function(index){return collections.at(_types,index)},size:function(){return collections.size(_types)},byName:function(name){return collections.byProperty(_types,"name",name)},toArray:function(){return angular.copy(_types)},removeAt:function(index){return collections.removeAt(_types,index)},last:function(){return collections.last(_types)},validate:_validate,create:_create}}),angular.module("farmbuild.soilSampleImporter").factory("importFieldSelector",function($log,farmdata,soilSampleConverter,importFieldTypes,collections,importFieldSelectionValidator){function _findPaddockWithName(paddocks,name){for(var i=0;i<paddocks.length;i++)if(name.trim().toUpperCase()==paddocks[i].name.toUpperCase())return paddocks[i];return void 0}$log.info("importFieldSelector ");var importFieldSelector={},_paddocks=[],_types=importFieldTypes.toArray();return importFieldSelector.createNew=function(myFarmData,columnHeaders,rows,paddockColumnIndex){if(!importFieldSelectionValidator.validateCreateNew(columnHeaders,rows))return void 0;if(0>paddockColumnIndex||paddockColumnIndex>=columnHeaders.length)return void 0;collections.add(columnHeaders,"Farm Paddock Name",paddockColumnIndex);for(var i=0;i<rows.length;i++)collections.add(rows[i],"",paddockColumnIndex);_paddocks=myFarmData.paddocks,importFieldSelector.paddocks=_paddocks;var result={dateLastUpdated:new Date,results:{columnHeaders:columnHeaders,rows:rows},importFieldDictionary:{},paddockRowDictionary:{},paddockNameColumn:paddockColumnIndex};return result},importFieldSelector.validate=importFieldSelectionValidator.validateImportFieldsDefinition,importFieldSelector.save=function(myFarmData,importFieldsSelection){if(!importFieldSelectionValidator.validateImportFieldsDefinition(importFieldsSelection))return void 0;for(var key in importFieldsSelection.paddockRowDictionary)for(var i=0;i<importFieldsSelection.paddockRowDictionary[key].length;i++){var rowIndex=importFieldsSelection.paddockRowDictionary[key][i];importFieldsSelection.results.rows[rowIndex][importFieldsSelection.paddockNameColumn]=key}return soilSampleConverter.toFarmData(myFarmData,importFieldsSelection)},importFieldSelector.autoLinkPaddock=function(importFieldsSelection,linkColumnIndex){var linkedCount=0;if(linkColumnIndex!=importFieldsSelection.paddockNameColumn){for(var mappedPaddock=Object.keys(importFieldsSelection.paddockRowDictionary),mappedRowIndex=[],i=0;i<mappedPaddock.length;i++)mappedRowIndex=mappedRowIndex.concat(importFieldsSelection.paddockRowDictionary[mappedPaddock[i]]);for(var i=0;i<importFieldsSelection.results.rows.length;i++)if(mappedRowIndex.indexOf(i)<0){var paddock=_findPaddockWithName(_paddocks,importFieldsSelection.results.rows[i][linkColumnIndex]);paddock&&(this.connectRow(importFieldsSelection,paddock,i),linkedCount++)}return linkedCount}},importFieldSelector.connectRow=function(importFieldsSelection,paddock,rowIndex){importFieldsSelection.paddockRowDictionary.hasOwnProperty(paddock.name)||(importFieldsSelection.paddockRowDictionary[paddock.name]=[]),collections.add(importFieldsSelection.paddockRowDictionary[paddock.name],rowIndex)},importFieldSelector.disconnectRow=function(importFieldsSelection,paddock,index){importFieldsSelection.paddockRowDictionary.hasOwnProperty(paddock.name)&&collections.remove(importFieldsSelection.paddockRowDictionary[paddock.name],index)},importFieldSelector.resetPaddockRowDictionary=function(paddockSelection){return paddockSelection.paddockRowDictionary={},paddockSelection},importFieldSelector.classifyColumn=function(importFieldsSelection,classificationType,index){importFieldsSelection.importFieldDictionary[classificationType.name]=index},importFieldSelector.declassifyColumn=function(paddockSelection,classificationType,index){delete paddockSelection.importFieldDictionary[classificationType.name]},importFieldSelector.types=_types,importFieldSelector.paddocks=_paddocks,importFieldSelector}),angular.module("farmbuild.soilSampleImporter").factory("importFieldSelectionValidator",function($log,validations,importFieldTypes){function _isEmptyObject(obj){var name;for(name in obj)return!1;return!0}var importFieldSelectionValidator={};return importFieldSelectionValidator.validateCreateNew=function(columnHeaders,rows){if(!validations.isDefined(columnHeaders)||0==columnHeaders.length)return $log.error("Soil import column headers must be a valid array"),!1;if(!validations.isDefined(rows)||0==rows.length)return $log.error("Soil import data row must be a valid array"),!1;for(var i=0;i<rows.length;i++){var aRow=rows[i];if(aRow.length!=columnHeaders.length)return!1}return!0},importFieldSelectionValidator.validateImportFieldsDefinition=function(importFieldsSelection){return validations.isEmpty(importFieldsSelection.paddockRowDictionary)||_isEmptyObject(importFieldsSelection.paddockRowDictionary)?!1:($log.info("importFieldTypes ",JSON.stringify(importFieldTypes.toArray())),importFieldTypes.toArray().length!=Object.keys(importFieldsSelection.importFieldDictionary).length?!1:!0)},importFieldSelectionValidator}),angular.module("farmbuild.soilSampleImporter").factory("paddockGroups",function($log,farmdata,validations,paddockGoupValidator,paddockSoilSampleRetriever){var _isDefined=validations.isDefined,paddockGroups=(validations.isArray,validations.isEmpty,{}),paddocksInPaddockGroup=function(farmData,paddockGroupName){var paddockList=[];if(!paddockGoupValidator.farmDataHasPaddockGroups(farmData))return void 0;for(var paddockGroups=farmData.paddockGroups,i=0;i<paddockGroups.length;i++){var singleGroup=paddockGroups[i];if(singleGroup.name==paddockGroupName){paddockList=singleGroup.paddocks;break}}return 0==paddockList.length?void 0:paddockList};paddockGroups.paddocksInPaddockGroup=paddocksInPaddockGroup;var averageForPaddockGroup=function(farmData,paddockGroupName){var groupPaddocks=paddockGroups.paddocksInPaddockGroup(farmData,paddockGroupName);if(!(_isDefined(groupPaddocks)&&groupPaddocks.length>0))return void 0;for(var allPaddockSoils=[],i=0;i<groupPaddocks.length;i++){var soilsSamples=paddockSoilSampleRetriever.soilSamplesInPaddock(farmData,groupPaddocks[i]);_isDefined(soilsSamples)&&(allPaddockSoils=allPaddockSoils.concat(soilsSamples))}var soils=farmData.soils;if(!_isDefined(soils))return void 0;var sampleResults=soils.sampleResults;if(!_isDefined(sampleResults))return void 0;var importFields=sampleResults.importFieldNames;if(!_isDefined(importFields))return void 0;var averageGroup=paddockSoilSampleRetriever.averagesForSoilSamples(importFields,allPaddockSoils);return $log.info("allPaddockSoils "+ +JSON.stringify(averageGroup,null,"  ")),averageGroup};return paddockGroups.averageForPaddockGroup=averageForPaddockGroup,paddockGroups}),angular.module("farmbuild.soilSampleImporter").factory("paddockGoupValidator",function($log,farmdata,validations){var _isDefined=validations.isDefined,paddockGoupValidator=(validations.isArray,validations.isEmpty,{});return paddockGoupValidator.farmDataHasPaddockGroups=function(farmData){if(!_isDefined(farmData))return!1;if(!_isDefined(farmData.paddockGroups))return!1;var paddockGoups=farmData.paddockGroups;return $log.info("paddockGroups length "+paddockGoups.length),paddockGoups.length>0?!0:!1},paddockGoupValidator}),angular.module("farmbuild.soilSampleImporter").factory("paddockSoilSampleRetriever",function($log,validations,importField){var _isDefined=validations.isDefined,_isEmpty=(validations.isArray,validations.isEmpty),paddockSoilSampleRetriever={};return paddockSoilSampleRetriever.soilSamplesInPaddock=function(farmData,paddockName){if(!_isDefined(farmData))return void $log.error("FarmData for soilSamplesInPaddock is invalid");var paddock=farmData.paddocks;$log.info("soilSamplesInPaddock main  "+paddock.length+"  paddock "+JSON.stringify(paddock,null,"  "));for(var singlePaddock,paddockSoil,i=0;i<paddock.length;i++)if(singlePaddock=paddock[i],singlePaddock.name==paddockName)return paddockSoil=singlePaddock.soils,paddockSoil.sampleResults;return _isDefined(paddockSoil)&&_isDefined(paddockSoil.sampleResults),void 0},paddockSoilSampleRetriever.averagesForSoilSamples=function(importFieldNames,soilSamples){if(!(_isDefined(importFieldNames)&&importFieldNames.length>0))return void 0;if(!(_isDefined(soilSamples)&&soilSamples.length>0))return void 0;for(var columnValues={},i=0;i<soilSamples.length;i++){var singelSoilSample=soilSamples[i];$log.info("singelSoilSample "+JSON.stringify(singelSoilSample,null,"  ")),$log.info("importFieldNames "+JSON.stringify(importFieldNames,null,"  "));for(var j=0;j<importFieldNames.length;j++){var fieldValue=singelSoilSample[importFieldNames[j]];if(!_isEmpty(fieldValue)&&!isNaN(fieldValue)&&null!=fieldValue){var singleColumn=columnValues[importFieldNames[j]];_isDefined(singleColumn)||(singleColumn={sum:0,count:0}),importField.hasAverage(importFieldNames[j])?(singleColumn.sum=singleColumn.sum+fieldValue,singleColumn.count=singleColumn.count+1):singleColumn=null,columnValues[importFieldNames[j]]=singleColumn}}}for(var averageValues={},j=0;j<importFieldNames.length;j++){var singleColumn=columnValues[importFieldNames[j]];_isDefined(singleColumn)&&(averageValues[importFieldNames[j]]=null==singleColumn?null:singleColumn.sum/singleColumn.count)}return averageValues},paddockSoilSampleRetriever.averagesForPaddock=function(farmData,paddockName){$log.info("averagesForPaddock");var soilSamples=paddockSoilSampleRetriever.soilSamplesInPaddock(farmData,paddockName);$log.info("soilSamples "+soilSamples);var soils=farmData.soils;if(!_isDefined(soils))return void 0;var sampleResults=soils.sampleResults;if(!_isDefined(sampleResults))return void 0;var importFields=sampleResults.importFieldNames;return _isDefined(importFields)?($log.info("b4 ret"),paddockSoilSampleRetriever.averagesForSoilSamples(importFields,soilSamples)):void 0},paddockSoilSampleRetriever}),angular.module("farmbuild.soilSampleImporter").factory("soilSampleImporterSession",function($log,farmdata,validations){function load(){var root=farmdata.session.find();return _isDefined(root)?root.soilSampleImporter:void 0}function save(toSave){var farmData=farmdata.session.find();return _isDefined(farmData)?(farmData.dateLastUpdated=new Date,farmData.soilSampleImporter=toSave,farmdata.session.save(farmData),toSave):void $log.error("Unable to find the farmData in the session!")}var soilSampleImporterSession={},_isDefined=validations.isDefined;return soilSampleImporterSession.saveSection=function(section,value){var loaded=load();return _isDefined(loaded)?(loaded[section]=value,save(loaded)):($log.error("Unable to find an existing farmData! please create then save."),soilSampleImporterSession)},soilSampleImporterSession.save=save,soilSampleImporterSession.loadSection=function(section){var loaded=load();return loaded?loaded[section]:null},soilSampleImporterSession.isLoadFlagSet=function(location){var load=!1;return location.href.split("?").length>1&&0===location.href.split("?")[1].indexOf("load")&&(load="true"===location.href.split("?")[1].split("=")[1]),load},soilSampleImporterSession.find=function(){return farmdata.session.find()},soilSampleImporterSession["export"]=function(document,farmData){return farmdata.session["export"](document,save(farmData))},soilSampleImporterSession}),angular.module("farmbuild.soilSampleImporter").constant("soilClassificationDefaults",{types:[{name:"pH H2O (Water)",ranges:[{name:["Very Acidic","Acidic","Slightly Acidic","Neutral"],min:[void 0,5.2,5.5,6.1],max:[5.2,5.5,6.1,void 0],defaultColor:["#fffe03","#96cf4c","#96cf4c","#aba3cc"]}]},{name:"Olsen Phosphorus (mg/kg)",ranges:[{name:["Deficient","Marginal","Adequate","High","Very High"],min:[void 0,9,14,20,27],max:[9,14,20,27,void 0],defaultColor:["#fff6a6","#98d6ea","#9fba9b","#ffbfdc","#ff7573"]}]},{name:"PBI",ranges:[{name:["Very Sandy","Sand, Sandy Loams","Sandy/Silty Loams","Sandy/Silty Clay Loams","Clay Loams","Clay Loams & Clay","Volcanic Clay & Peat"],min:[void 0,15,35,70,140,280,840],max:[15,35,70,140,280,840,void 0],defaultColor:[void 0,void 0,void 0,void 0,void 0,void 0,void 0]}]},{name:"KCl 40 Sulphur (mg/kg)",ranges:[{name:["Deficient","Marginal","Adequate","High","Very High"],min:[void 0,4.5,7.5,10.5,14],max:[4.5,7.5,10.5,14,void 0],defaultColor:["#fff6a6","#98d6ea","#9fba9b","#ffbfdc","#ff7573"]}]},{name:"Colwell Phosphorus (mg/kg)",ranges:[{name:["Deficient","Marginal","Adequate","High","Very High"],dependencyRange:{name:["PBI"],min:[void 0],max:[15],defaultColor:[void 0]},min:[void 0,15,23,30,41],max:[15,23,30,41,void 0],defaultColor:["#fff6a6","#98d6ea","#9fba9b","#ffbfdc","#ff7573"]},{name:["Deficient","Marginal","Adequate","High","Very High"],dependencyRange:{name:["PBI"],min:[15],max:[35],defaultColor:[void 0]},min:[void 0,17,26,34,47],max:[17,26,34,47,void 0],defaultColor:["#fff6a6","#98d6ea","#9fba9b","#ffbfdc","#ff7573"]},{name:["Deficient","Marginal","Adequate","High","Very High"],dependencyRange:{name:["PBI"],min:[35],max:[70],defaultColor:[void 0]},min:[void 0,19,30,39,53],max:[19,30,39,53,void 0],defaultColor:["#fff6a6","#98d6ea","#9fba9b","#ffbfdc","#ff7573"]},{name:["Deficient","Marginal","Adequate","High","Very High"],dependencyRange:{name:["PBI"],min:[70],max:[140],defaultColor:[void 0]},min:[void 0,22,35,45,61],max:[22,35,45,61,void 0],defaultColor:["#fff6a6","#98d6ea","#9fba9b","#ffbfdc","#ff7573"]},{name:["Deficient","Marginal","Adequate","High","Very High"],dependencyRange:{name:["PBI"],min:[140],max:[280],defaultColor:[void 0]},min:[void 0,26,42,54,74],max:[26,42,54,74,void 0],defaultColor:["#fff6a6","#98d6ea","#9fba9b","#ffbfdc","#ff7573"]},{name:["Deficient","Marginal","Adequate","High","Very High"],dependencyRange:{name:["PBI"],min:[280],max:[840],defaultColor:[void 0]},min:[void 0,37,58,75,102],max:[37,58,75,102,void 0],defaultColor:["#fff6a6","#98d6ea","#9fba9b","#ffbfdc","#ff7573"]},{name:["Deficient","Marginal","Adequate","High","Very High"],dependencyRange:{name:["PBI"],min:[840],max:[void 0],defaultColor:[void 0]},min:[void 0,50,90,120,150],max:[50,90,120,150,void 0],defaultColor:["#fff6a6","#98d6ea","#9fba9b","#ffbfdc","#ff7573"]}]},{name:"Colwell Potassium (mg/kg)",ranges:[{name:["Deficient","Marginal","Adequate","High","Very High"],dependencyRange:{name:["PBI"],min:[void 0],max:[35],defaultColor:[void 0]},min:[void 0,70,120,170,230],max:[70,120,170,230,void 0],defaultColor:["#fff6a6","#98d6ea","#9fba9b","#ffbfdc","#ff7573"]},{name:["Deficient","Marginal","Adequate","High","Very High"],dependencyRange:{name:["PBI"],min:[35],max:[70],defaultColor:[void 0]},min:[void 0,80,130,190,250],max:[80,130,190,250,void 0],defaultColor:["#fff6a6","#98d6ea","#9fba9b","#ffbfdc","#ff7573"]},{name:["Deficient","Marginal","Adequate","High","Very High"],dependencyRange:{name:["PBI"],min:[70],max:[280],defaultColor:[void 0]},min:[void 0,90,130,190,260],max:[90,130,190,260,void 0],defaultColor:["#fff6a6","#98d6ea","#9fba9b","#ffbfdc","#ff7573"]},{name:["Deficient","Marginal","Adequate","High","Very High"],dependencyRange:{name:["PBI"],min:[280],max:[void 0],defaultColor:[void 0]},min:[void 0,100,150,220,280],max:[100,150,220,280,void 0],defaultColor:["#fff6a6","#98d6ea","#9fba9b","#ffbfdc","#ff7573"]}]},{name:"Exch Potassium (meq/100g)",ranges:[{name:["Deficient","Marginal","Adequate","High","Very High"],dependencyRange:{name:["PBI"],min:[void 0],max:[35],defaultColor:[void 0]},min:[void 0,.18,.31,.44,.6],max:[.18,.31,.44,.6,void 0],defaultColor:["#fff6a6","#98d6ea","#9fba9b","#ffbfdc","#ff7573"]},{name:["Deficient","Marginal","Adequate","High","Very High"],dependencyRange:{name:["PBI"],min:[35],max:[70],defaultColor:[void 0]},min:[void 0,.2,.33,.49,.64],max:[.2,.33,.49,.64,void 0],defaultColor:["#fff6a6","#98d6ea","#9fba9b","#ffbfdc","#ff7573"]},{name:["Deficient","Marginal","Adequate","High","Very High"],dependencyRange:{name:["PBI"],min:[70],max:[280],defaultColor:[void 0]},min:[void 0,.23,.33,.53,.66],max:[.23,.33,.53,.66,void 0],defaultColor:["#fff6a6","#98d6ea","#9fba9b","#ffbfdc","#ff7573"]},{name:["Deficient","Marginal","Adequate","High","Very High"],dependencyRange:{name:["PBI"],min:[280],max:[void 0],defaultColor:[void 0]},min:[void 0,.26,.39,.56,.72],max:[.26,.39,.56,.72,void 0],defaultColor:["#fff6a6","#98d6ea","#9fba9b","#ffbfdc","#ff7573"]}]}]}),angular.module("farmbuild.soilSampleImporter").factory("soilClassification",function($log,soilClassificationTypes,validations){function _isWithinRange(min,max,classificationValue){return!_isDefined(min)&&_isDefined(max)?max>=classificationValue:_isDefined(min)&&_isDefined(max)?classificationValue>min&&max>=classificationValue:_isDefined(min)&&!_isDefined(max)?classificationValue>min:!1}function _findRangeIndex(minArray,maxArray,classificationValue){for(var i=0;i<minArray.length;i++)if(_isWithinRange(minArray[i],maxArray[i],classificationValue))return i;return-1}function _copyResult(classificationRange,index){if(index>=0&&index<classificationRange.name.length){var result={};return result.name=classificationRange.name[index],result.min=classificationRange.min[index],result.max=classificationRange.max[index],result.defaultColor=classificationRange.defaultColor[index],result}return void 0}function _isValidType(anObject){try{if(_isDefined(anObject)&&_isDefined(anObject.name)&&_isDefined(anObject.ranges))return!0}catch(err){}return!1}$log.info("soilClassification ");var soilClassification={},_isDefined=validations.isDefined;return soilClassification.findRange=function(classificationType,classificationValue){if(!_isValidType(classificationType))return void 0;for(var i=0;i<classificationType.ranges.length;i++){var aRange=classificationType.ranges[i],index=_findRangeIndex(aRange.min,aRange.max,classificationValue);if(index>=0)return _copyResult(aRange,index)}return void 0},soilClassification.findRangeWithDependency=function(classificationType,classificationValue,dependencyValue){if(!_isValidType(classificationType))return void 0;for(var i=0;i<classificationType.ranges.length;i++){var aRange=classificationType.ranges[i];if(_findRangeIndex(aRange.dependencyRange.min,aRange.dependencyRange.max,dependencyValue)>=0){var index=_findRangeIndex(aRange.min,aRange.max,classificationValue);return index>=0?_copyResult(aRange,index):void 0}}return void 0},soilClassification.classifyResult=function(sampleResult,key){var type=soilClassificationTypes.byName(key);return type?soilClassification.findRange(type,sampleResult[key]):void 0},soilClassification}),angular.module("farmbuild.soilSampleImporter").factory("soilClassificationTypes",function(collections,validations,soilClassificationDefaults,$log){function _create(name){var type={name:name};return type}function _validate(type){$log.info("validating type  ...",type);var valid=!_isEmpty(type)&&!_isEmpty(type.name);return valid||$log.error("invalid type: %j",type),valid}function _add(types,name){var type=_create(name);return $log.info("adding a type ...",type),_validate(type)?collections.add(types,type):void 0}var soilClassificationTypes,_isEmpty=(validations.isPositiveNumber,validations.isPositiveNumberOrZero,validations.isEmpty),_types=(validations.isDefined,angular.copy(soilClassificationDefaults.types));return soilClassificationTypes={add:_add,at:function(index){return collections.at(_types,index)},size:function(){return collections.size(_types)},byName:function(name){return collections.byProperty(_types,"name",name)},toArray:function(){return angular.copy(_types)},removeAt:function(index){return collections.removeAt(_types,index)},last:function(){return collections.last(_types)},validate:_validate,create:_create}}),angular.module("farmbuild.soilSampleImporter").run(function(soilSampleImporter){}),angular.injector(["ng","farmbuild.soilSampleImporter"]);
//# sourceMappingURL=farmbuild-nutrientcalculator.min.js.map